machine:
  services:
    - docker
    - rabbitmq-server
    - redis
  environment:
    TESTS_HOST: localhost
    GODIST: "go1.8.1.linux-amd64.tar.gz"
  post:
    - mkdir -p downloads
    - test -e downloads/$GODIST || curl -o downloads/$GODIST https://storage.googleapis.com/golang/$GODIST
    - sudo rm -rf /usr/local/go
    - sudo tar -C /usr/local -xzf downloads/$GODIST
test:
  pre:
    - docker run -p 61613:61613 -e RABBITMQ_DEFAULT_VHOST=127.0.0.1 -d byteflair/rabbitmq-stomp
  override:
    - go test -v -coverprofile=coverage.txt -covermode=atomic ./...
  post:
    - bash <(curl -s https://codecov.io/bash)